<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
        <!-- 구글 지도 api에서 호텔 가격 및 상세 정보 확인 필요-->
<head>
    <meta charset="UTF-8">
    <title>호텔 검색 결과</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../static/css/hotels.css"/> <!-- css 연결-->
    <link rel="stylesheet" href="../static/css/header.css"><!-- header css 연결-->
    <link rel="stylesheet" href="../static/css/searchResult.css"><!-- header css 연결-->
    <link rel="stylesheet" href="../static/css/map.css"><!-- map css 연결-->

</head>


<body>
<div class="header-body">     <!-- header-->
    <header>

        <div class="left-section">
            <button type="button" class="btn logo-button">
                <img src="../static/html/layout/LOGO.png" alt="YAYEOGI 로고" >
            </button>
            &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

            <p>
            <div class="menu">
                <button type="button" class="btn btn-info">항공권</button>
                <button type="button" class="btn btn-info">호텔</button>
            </div>
        </div>
        </p>
        <div class="auth">
            <button type="button" class="btn btn-secondary">
                회원가입
            </button>
            <button type="button" class="btn btn-secondary">
                로그인
            </button>
            <!--          <div class="auth">
                            <button type="button" >
                                <img> 찜
                            </button>
                            <button type="button" >
                                <img> 내정보
                            </button>
                                  <button type="button" >
                                <img> 로그아웃
                            </button> -->

        </div>
    </header>
</div>
<main id="hotels_search_page" >

<div class="search_form">
    <div class="search-bar" style="margin-top:20px;"> <!--검색창-->
        <label>
            <input type="text"  id="city" placeholder="목적지 또는 호텔명을 입력하십시오." size=60>
            <input type="date" value="2024-07-31" size=30>
            <input type="date" value="2024-08-01">
            <select id="guest-button" style="width:250px;">
                <option>성인 2명, 객실 1개</option>
            </select>
            <button type="button" id="searchBtn" class="btn btn-primary" onclick="performSearch()">검색 버튼</button>
        </label>
    </div>
</div>
    <div class="main-container" style="display: flex;">
<div style="width:280px;height:500px; margin-left:30px;margin-top:20px;">       <!-- 조건창 - 별점 -->
    <h4 style="font-size:18px;font-weight:bold;">별점</h4>
    <div class="form-check">
        <input class="form-check-input rating" type="checkbox" value="5" id="rating5" onclick="filterHotelsByRating(5)">
        <label class="form-check-label" for="rating5" style="font-size:15px;">
            5개
            <img src="../static/html/hotels/img/star/star5.png" alt="star5" style="width:125px;height25px;">
        </label>
        </div>
        <div class="form-check">
        <input class="form-check-input rating" type="checkbox" value="4" id="rating4"  onclick="filterHotelsByRating(4)">
        <label class="form-check-label" for="rating4" style="font-size:15px;">
            4개
            <img src="../static/html/hotels/img/star/star4.png" alt="star4" style="margin-left:6px;width:95px;height25px;">
        </label>
            </div>
            <div class="form-check">
        <input class="form-check-input rating" type="checkbox" value="3" id="rating3"  onclick="filterHotelsByRating(3)">
        <label class="form-check-label" for="rating3" style="font-size:15px;">
            3개
            <img src="../static/html/hotels/img/star/star3.png" alt="star3" style="margin-left:7px;width:70px;height25px;">
        </label>
            </div>
    <div class="form-check">
        <input class="form-check-input rating" type="checkbox" value="2" id="rating2"  onclick="filterHotelsByRating(2)">
        <label class="form-check-label" for="rating2" style="font-size:15px;">
            2개
            <img src="../static/html/hotels/img/star/star2.png" alt="star2" style="margin-left:5px;width:50px;height25px;">
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input rating" type="checkbox" value="1" id="rating1"  onclick="filterHotelsByRating(1)">
        <label class="form-check-label" for="rating1" style="font-size:15px;">
            1개
            <img src="../static/html/hotels/img/star/star1.png" alt="star1" style="margin-left:7px;width:25px;height25px;">
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input rating" type="checkbox" value="0" id="rating0"  onclick="filterHotelsByRating(0)">
        <label class="form-check-label" for="rating0" style="font-size:15px;">
            0개
        </label>
    </div>

        <h4 style="font-size:18px;font-weight:bold;margin-top:20px;">가격</h4> <!--  가격 조건창 -->
        <div class="form-check">
            <input class="form-check-input price" type="checkbox" value="" id="price1">
            <label class="form-check-label" for="price1" style="font-size:15px;">
               ￦0 - ￦50,000

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input price" type="checkbox" value="" id="price2">
            <label class="form-check-label" for="price2" style="font-size:15px;">
                ￦51,000 - ￦100,000

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input price" type="checkbox" value="" id="price3">
            <label class="form-check-label" for="price3" style="font-size:15px;">
                ￦101,000 - ￦150,000

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input price" type="checkbox" value="" id="price4">
            <label class="form-check-label" for="price4" style="font-size:15px;">
                ￦151,000 - ￦200,000

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input price" type="checkbox" value="" id="price5">
            <label class="form-check-label" for="price5" style="font-size:15px;">
                ￦201,000 - ￦250,000

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input price" type="checkbox" value="" id="price6">
            <label class="form-check-label" for="price6" style="font-size:15px;" >
                ￦251,000 +
            </label>
        </div>
    </div>
    <div class="card-container" style="overflow-y: auto; height:800px;" >                <!-- 목록 -->
        <div class="card mb-3" style="max-width: 900px; height: 300px;border:none;">
            <div class="row g-0" style="height: 100%;"> <!-- 행 높이도 100%로 설정 -->
                <div id="hotel-list"></div>
            </div>
        </div>

                <!-- 카드 값 추가 위치 -->
    </div>


        <div id="map" style="width:860px;height:800px;">

        </div>
    </div>


</main>

<div class="footer-body"  style="height : auto; min-height: 10%;">       <!-- footer-->
    <div class="container" id="footer">
        <hr>
        <div class="footer-box">
            <div class="gray_subtext">
                    <span>
                        (주)YAYEOGI | 대표이사: 홍길동 | 사업자 등록번호: 000-00-000000 | 통신판매업신고: 야여기-0000호 | 메일: help@yayeogi.com
                        <br>관광사업자 등록번호: 제2022-05호 | 주소: 서울 강남구 테헤란로 000길 00 | 호스팅서비스 제공자: 주식회사 YAYEOGI
                        <br>고객센터: 1644-1346 (오전 9시 - 익일 새벽 3시)
                        <br>(주)GOING은 통신판매 중개자로서 통신판매의 당사자가 아니며 상품의 예약, 이용 및 환불 등과 관련한 의무와 책임은 각 판매자에게 있습니다.
                        <br>(주)GOING이 소유/운영/관리하는 웹사이트 및 앱 내의 상품/판매자/이벤트 정보, 디자인 및 화면의 구성, UI를 포함하여 일체의 콘텐츠에 대한 무단 복제, 배포, 방송 또는 전송, 스크래핑 등의 행위는 저작권법 및 콘텐츠산업 진흥법 등 관련 법령에 의하여 엄격히 금지됩니다.
                    </span>
            </div>
        </div>
        <hr>
    </div>
</div>

<script>
    // 가격 범위 정의 (천 원 단위)
 const minPrice = 50000;
 const maxPrice = 300000;
 let randomPrice;

 // 난수로 천 원 단위 가격 생성 함수
 function getRandomPrice(min, max) {
     // 천 원 단위로 나누어 정수로 변환
     const minUnits = Math.ceil(min / 1000);
     const maxUnits = Math.floor(max / 1000);

     // 난수로 단위 범위 내에서 가격 생성
     const randomUnits = Math.floor(Math.random() * (maxUnits - minUnits + 1)) + minUnits;

     // 다시 천 원 단위로 변환
     return randomUnits * 1000;
 }

 function generateRandomPrice() {
    randomPrice = getRandomPrice(minPrice, maxPrice);
}

 let map, service, autocomplete, markers = [], currentInfoWindow = null;

 function initMap() {
     map = new google.maps.Map(document.getElementById("map"), {
         center: { lat: 37.57295, lng: 126.97915 }, // 서울 광화문
         zoom: 12,
     });

     autocomplete = new google.maps.places.Autocomplete(document.getElementById("city"));
     autocomplete.bindTo('bounds', map);

     const searchBtn = document.getElementById("searchBtn");
     searchBtn.addEventListener('click', () => {
         const query = document.getElementById("city").value;
         if (query) {
             searchPlaces(query);
         } else {
             alert('Please enter a valid city or hotel.');
         }
     });
 }

 function searchPlaces(query) {
     service = new google.maps.places.PlacesService(map);

     const placeRequest = {
         query: query,
         fields: ['formatted_address', 'name', 'photos', 'geometry', 'place_id', 'price_level', 'rating'],
     };

     service.findPlaceFromQuery(placeRequest, (results, status) => {
         if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
             clearMarkers();

             const place = results[0];
             const placeLocation = place.geometry.location;

             const placeMarker = new google.maps.Marker({
                 position: placeLocation,
                 map: map,
                 title: place.name
             });

             const placeInfoWindow = new google.maps.InfoWindow({
                 content: createInfoWindowContent(place)
             });

             placeMarker.addListener('click', () => {
                 if (currentInfoWindow) {
                     currentInfoWindow.close();
                 }
                 currentInfoWindow = placeInfoWindow;
                 placeInfoWindow.open(map, placeMarker);
             });

             placeInfoWindow.open(map, placeMarker);

             map.setCenter(placeLocation);
             map.setZoom(15);

             searchNearbyHotels(placeLocation, place);
         } else {
             alert('No matching places found.');
         }
     });
 }

 function searchNearbyHotels(center, highlightedPlace) {
     const request = {
         location: center,
         radius: '5000', // 검색 반경 (미터)
         type: ['lodging']
     };

     service.nearbySearch(request, (results, status) => {
         if (status === google.maps.places.PlacesServiceStatus.OK) {
             const hotelListDiv = document.getElementById('hotel-list');
             hotelListDiv.innerHTML = ''; // Clear previous results

             // 마커를 저장할 배열
             markers = [];

             // 일치하는 항목을 제일 위에 표시
             if (highlightedPlace) {
                 const highlightedCard = createHotelCard(highlightedPlace, true);
                 hotelListDiv.appendChild(highlightedCard);

                 // 일치하는 항목에 마커 추가
                 const highlightedMarker = new google.maps.Marker({
                     position: highlightedPlace.geometry.location,
                     map: map,
                     title: highlightedPlace.name,
                     icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png' // 다른 색상으로 구분
                 });

                 const highlightedInfoWindow = new google.maps.InfoWindow({
                     content: createInfoWindowContent(highlightedPlace)
                 });

                 highlightedMarker.addListener('click', () => {
                     if (currentInfoWindow) {
                         currentInfoWindow.close();
                     }
                     currentInfoWindow = highlightedInfoWindow;
                     highlightedInfoWindow.open(map, highlightedMarker);
                     // 클릭된 호텔 카드 맨 위로 이동
                     moveCardToTop(highlightedPlace.place_id);
                 });

                 markers.push(highlightedMarker);
             }

             results.forEach(hotel => {
                 if (hotel.place_id !== highlightedPlace.place_id) { // 일치하는 항목은 제외
                     const hotelCard = createHotelCard(hotel, false);
                     hotelListDiv.appendChild(hotelCard);

                     // 주변 호텔에 마커 추가
                     const marker = new google.maps.Marker({
                         position: hotel.geometry.location,
                         map: map,
                         title: hotel.name
                     });

                     const infoWindow = new google.maps.InfoWindow({
                         content: createInfoWindowContent(hotel)
                     });

                     marker.addListener('click', () => {
                         if (currentInfoWindow) {
                             currentInfoWindow.close();
                         }
                         currentInfoWindow = infoWindow;
                         infoWindow.open(map, marker);
                         // 클릭된 호텔 카드 맨 위로 이동
                         moveCardToTop(hotel.place_id);
                     });

                     markers.push(marker);
                 }
             });

             // 검색 결과가 없을 때의 처리
             if (results.length === 0 && !highlightedPlace) {
                 hotelListDiv.innerHTML = '<p>No nearby hotels found.</p>';
             }
         } else {
             console.error('Nearby search failed: ', status);
             alert('Nearby search failed: ' + status);
         }
     });
 }

 function clearMarkers() {
     markers.forEach(marker => marker.setMap(null));
     markers = [];
     if (currentInfoWindow) {
         currentInfoWindow.close();
         currentInfoWindow = null;
     }
 }

 function createHotelCard(hotel, isHighlighted) {
     // 가격을 랜덤으로 생성
     const randomPrice = getRandomPrice(50000, 300000);

     const card = document.createElement('div');
     card.classList.add('card', 'mb-3');
     card.style.maxWidth = '900px';
     card.style.height = '300px';
     card.dataset.placeId = hotel.place_id; // 카드에 place_id를 데이터 속성으로 추가

     card.innerHTML = `
         <div class="row g-0" style="height: 100%;">
             <div class="col-md-4" style="height: 100%;">
                 ${hotel.photos ? `<img src="${hotel.photos[0].getUrl()}" class="img-fluid rounded-start responsive-image" alt="${hotel.name}" style="height: 100%; object-fit: cover;">` : ''}
             </div>
             <div class="col-md-8">
                 <div class="card-body">
                     <h5 class="card-title" style="font-weight:bold; font-size:30px;">${hotel.name}</h5>
                     <p class="card-text" style="font-size:15px;">
                         ${hotel.vicinity}
                     </p>
                     <p class="card-text">
                         ${getRatingStars(hotel.rating)}
                         <br><br><br><br>
                         ${hotel.rating || '0'}/5
                     </p>
                     <p class="text-body-secondary" style="float:right;">Price: ${randomPrice.toLocaleString()}</p>
                 </div>
             </div>
         </div>
     `;

     card.addEventListener('click', () => {
         window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(hotel.name)}`, '_blank');
     });

     if (isHighlighted) {
         card.style.border = '2px solid blue'; // 강조된 카드에 스타일 적용
     }

     return card;
 }

 function createInfoWindowContent(place) {
     return `
         ${place.photos ? `<img src="${place.photos[0].getUrl()}" alt="${place.name}" style="width: 100%; height: 150px; object-fit: cover; margin-bottom: 10px;">` : ''}
         <h6>${place.name}</h6>
         <p>Address: ${place.formatted_address || place.vicinity}</p>
         <p>${place.rating}/5</p>
         <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.name)}" target="_blank">Hotel Details</a>
     `;
 }

 function getPriceString(priceLevel) {
     switch (priceLevel) {
         case 1:
             return '₩0 - ₩50,00';
         case 2:
             return '₩51,000 - ₩161,600';
         case 3:
             return '₩101,000 - ₩150,000';
         case 4:
             return '₩151,000 - ₩200,000';
         case 5:
             return '₩201,000 - ₩250,000';
             case 6:
             return '251,000 +';
         default:
             return 'N/A';
     }
 }

 function getRatingStars(rating) {
     if (rating >= 5) {
         return `<img src="../static/html/hotels/img/star/star5.png" alt="${rating}" style="width:125px;height:25px;">`;
     } else if (rating >= 4) {
         return `<img src="../static/html/hotels/img/star/star4.png" alt="${rating}" style="width:95px;height:25px;">`;
     } else if (rating >= 3) {
         return `<img src="../static/html/hotels/img/star/star3.png" alt="${rating}" style="width:70px;height:25px;">`;
     } else if (rating >= 2) {
         return `<img src="../static/html/hotels/img/star/star2.png" alt="${rating}" style="width:50px;height:25px;">`;
     } else if (rating >= 1) {
         return `<img src="../static/html/hotels/img/star/star1.png" alt="${rating}" style="width:25px;height:25px;">`;
     } else {
         return '';
     }
 }

 // 카드 리스트에서 특정 ID의 카드를 맨 위로 이동
 function moveCardToTop(placeId) {
     const hotelListDiv = document.getElementById('hotel-list');
     const card = hotelListDiv.querySelector(`[data-place-id="${placeId}"]`);
     if (card) {
         hotelListDiv.prepend(card); // 카드 리스트의 가장 상단으로 이동
     }
 }

 document.addEventListener('DOMContentLoaded', initMap);


    const checkboxes = document.querySelectorAll('.rating');


    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            // Uncheck all checkboxes except the one that was clicked
            checkboxes.forEach(cb => {
                if (cb !== checkbox) {
                    cb.checked = false;
                }
            });
        });
    });

    const checkboxes1 = document.querySelectorAll('.price');
    checkboxes1.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            checkboxes1.forEach(cb => {
                if (cb !== checkbox) {
                    cb.checked = false;
                }
            });
        });
    });


    const hotels = [
         { name: '호텔 A', rating: 2.5 },
    { name: '호텔 B', rating: 3.0 },
    { name: '호텔 C', rating: 3.5 },
    { name: '호텔 D', rating: 4.0 },
    { name: '호텔 E', rating: 4.5 },
    { name: '호텔 F', rating: 4.8 },
    { name: '호텔 G', rating: 5.0 },
      ];

function filterHotelsByRating(star) {
    // 선택한 별점 이상이고 다음 별점 미만인 호텔을 필터링
    const filteredHotels = hotels.filter(hotel => {
        return hotel.rating >= star && hotel.rating < star + 1;
    });
    displayHotels(filteredHotels);
}

function displayHotels(hotelList) {
    const hotelListDiv = document.getElementById('hotelList');
    hotelListDiv.innerHTML = ''; // 기존 내용을 지웁니다

    hotelList.forEach(hotel => {
        const hotelDiv = document.createElement('div');
        hotelDiv.textContent = `${hotel.name} - ${hotel.rating}성`;
        hotelListDiv.appendChild(hotelDiv);
    });
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJmWcT4VLac8E7KNO0HS0uP43Bn-IewbU&callback=initMap&libraries=places&v=weekly"
        defer>

</script>



</body>
</html>