<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
        <!-- 구글 지도 api에서 호텔 가격 및 상세 정보 확인 필요-->
<head>
    <meta charset="UTF-8">
    <title>저렴한 호텔 비교 특가</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../static/css/hotels.css"/> <!-- css 연결-->
    <link rel="stylesheet" href="../static/css/header.css"><!-- header css 연결-->
    <link rel="stylesheet" href="../static/css/searchResult.css"><!-- header css 연결-->
    <link rel="stylesheet" href="../static/css/map.css"><!-- map css 연결-->

</head>


<body>
<div class="header-body">     <!-- header-->
    <header>

        <div class="left-section">
            <button type="button" class="btn logo-button">
                <img src="../static/html/layout/LOGO.png" alt="YAYEOGI 로고" >
            </button>
            &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

            <p>
            <div class="menu">
                <button type="button" class="btn btn-info">항공권</button>
                <button type="button" class="btn btn-info">호텔</button>
            </div>
        </div>
        </p>
        <div class="auth">
            <button type="button" class="btn btn-secondary">
                회원가입
            </button>
            <button type="button" class="btn btn-secondary">
                로그인
            </button>
            <!--          <div class="auth">
                            <button type="button" >
                                <img> 찜
                            </button>
                            <button type="button" >
                                <img> 내정보
                            </button>
                                  <button type="button" >
                                <img> 로그아웃
                            </button> -->

        </div>
    </header>
</div>
<main id="hotels_search_page" >

<div class="search_form">
    <div class="search-bar" style="margin-top:20px;"> <!--검색창-->
        <label>
            <input type="text"  id="city" placeholder="목적지 또는 호텔명을 입력하십시오." size=60>
            <input type="date" value="2024-07-31" size=30>
            <input type="date" value="2024-08-01">
            <select id="guest-button" style="width:250px;">
                <option>성인 2명, 객실 1개</option>
            </select>
            <button type="button" id="searchBtn" class="btn btn-primary" onclick="performSearch()">검색 버튼</button>
        </label>
    </div>
</div>
    <div class="main-container" style="display: flex;">
<div style="width:280px;height:500px; margin-left:30px;margin-top:20px;">       <!-- 조건창 - 별점 -->
    <h4 style="font-size:18px;font-weight:bold;">등급</h4>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="rating5">
        <label class="form-check-label" for="rating5" style="font-size:15px;">
            5성급
            <img src="../static/html/hotels/img/star/star5.png" alt="star5" style="width:125px;height25px;">
        </label>
        </div>
        <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="rating4">
        <label class="form-check-label" for="rating4" style="font-size:15px;">
            4성급
            <img src="../static/html/hotels/img/star/star4.png" alt="star4" style="margin-left:6px;width:95px;height25px;">
        </label>
            </div>
            <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="rating3">
        <label class="form-check-label" for="rating3" style="font-size:15px;">
            3성급
            <img src="../static/html/hotels/img/star/star3.png" alt="star3" style="margin-left:7px;width:70px;height25px;">
        </label>
            </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="rating2">
        <label class="form-check-label" for="rating2" style="font-size:15px;">
            2성급
            <img src="../static/html/hotels/img/star/star2.png" alt="star2" style="margin-left:5px;width:50px;height25px;">
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="rating1">
        <label class="form-check-label" for="rating1" style="font-size:15px;">
            1성급
            <img src="../static/html/hotels/img/star/star1.png" alt="star1" style="margin-left:7px;width:25px;height25px;">
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="rating0">
        <label class="form-check-label" for="rating0" style="font-size:15px;">
            등급 없음
        </label>
    </div>

        <h4 style="font-size:18px;font-weight:bold;margin-top:20px;">가격</h4> <!--  가격 조건창 -->
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="price1">
            <label class="form-check-label" for="price1" style="font-size:15px;">
               ￦0 - ￦80,800

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="price2">
            <label class="form-check-label" for="price2" style="font-size:15px;">
                ￦80,800 - ￦161,600

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="price3">
            <label class="form-check-label" for="price3" style="font-size:15px;">
                ￦161,600 - ￦242,400

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="price4">
            <label class="form-check-label" for="price4" style="font-size:15px;">
                ￦242,400 - ￦323,200

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="price5">
            <label class="form-check-label" for="price5" style="font-size:15px;">
                ￦323,200 - ￦404,000

            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="price6">
            <label class="form-check-label" for="price6" style="font-size:15px;" >
                ￦404,000 +
            </label>
        </div>
    </div>
    <div class="card-container" style="overflow-y: auto; height:800px;" >                <!-- 목록 -->
        <div class="card mb-3" style="max-width: 900px; height: 300px;">
            <div class="row g-0" style="height: 100%;"> <!-- 행 높이도 100%로 설정 -->
                <div class="col-md-4" style="height: 100%;"> <!-- 열 높이도 100%로 설정 -->
                    <img src="../static/html/hotels/img/product1.png" class="img-fluid rounded-start responsive-image" alt="로피 하우스">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title">로피 하우스</h5>
                        <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                        <p class="card-text"><small class="text-body-secondary">Last updated 3 mins ago</small></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-3" style="max-width: 900px; height: 300px;">
            <div class="row g-0" style="height: 100%;"> <!-- 행 높이도 100%로 설정 -->
                <div class="col-md-4" style="height: 100%;"> <!-- 열 높이도 100%로 설정 -->
                    <img src="../static/html/hotels/img/product1.png" class="img-fluid rounded-start responsive-image" alt="로피 하우스">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title">로피 하우스</h5>
                        <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                        <p class="card-text"><small class="text-body-secondary">Last updated 3 mins ago</small></p>
                    </div>
                </div>
            </div>
        </div>

                <!-- 카드 값 추가 위치 -->
    </div>


        <div id="map" style="width:860px;height:800px;">

        </div>
    </div>


</main>

<div class="footer-body"  style=" height : auto; min-height: 100%;">       <!-- footer-->
    <div class="container" id="footer">
        <hr>
        <div class="footer-box">
            <div class="gray_subtext">
                    <span>
                        (주)YAYEOGI | 대표이사: 홍길동 | 사업자 등록번호: 000-00-000000 | 통신판매업신고: 야여기-0000호 | 메일: help@yayeogi.com
                        <br>관광사업자 등록번호: 제2022-05호 | 주소: 서울 강남구 테헤란로 000길 00 | 호스팅서비스 제공자: 주식회사 YAYEOGI
                        <br>고객센터: 1644-1346 (오전 9시 - 익일 새벽 3시)
                        <br>(주)GOING은 통신판매 중개자로서 통신판매의 당사자가 아니며 상품의 예약, 이용 및 환불 등과 관련한 의무와 책임은 각 판매자에게 있습니다.
                        <br>(주)GOING이 소유/운영/관리하는 웹사이트 및 앱 내의 상품/판매자/이벤트 정보, 디자인 및 화면의 구성, UI를 포함하여 일체의 콘텐츠에 대한 무단 복제, 배포, 방송 또는 전송, 스크래핑 등의 행위는 저작권법 및 콘텐츠산업 진흥법 등 관련 법령에 의하여 엄격히 금지됩니다.
                    </span>
            </div>
        </div>
        <hr>
    </div>
</div>

<script>

    let map, service, autocomplete, markers = [], currentInfoWindow = null;

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 37.57295, lng: 126.97915 }, // 서울 광화문
            zoom: 8,
        });

        autocomplete = new google.maps.places.Autocomplete(document.getElementById("city"));
        autocomplete.bindTo('bounds', map);

        const searchBtn = document.getElementById("searchBtn");
        searchBtn.addEventListener('click', () => {
            const place = autocomplete.getPlace();
            if (place && place.geometry) {
                const cityLocation = {
                    lat: place.geometry.location.lat(),
                    lng: place.geometry.location.lng()
                };
                map.setCenter(cityLocation);
                map.setZoom(12);
                searchHotels(cityLocation, place.name);
            } else {
                alert('Please enter a valid city or hotel.');
            }
        });
    }

    function searchHotels(cityLocation, searchName) {
        service = new google.maps.places.PlacesService(map);

        const request = {
            location: cityLocation,
            radius: '5000',  // Search radius (meters)
            type: ['lodging']  // 'lodging' type to find hotels
        };

        service.nearbySearch(request, (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                clearMarkers();
                let foundMatchingPlace = false;

                results.forEach(place => {
                    const marker = new google.maps.Marker({
                        position: place.geometry.location,
                        map: map,
                        title: place.name
                    });

                    markers.push(marker);

                    if (place.name.toLowerCase().includes(searchName.toLowerCase())) {
                        foundMatchingPlace = true;
                        service.getDetails({ placeId: place.place_id }, (placeDetails, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK) {
                                const priceLevel = placeDetails.price_level;
                                const priceString = getPriceString(priceLevel);
                                const photoUrl = placeDetails.photos ? placeDetails.photos[0].getUrl() : '';

                                const infoWindow = new google.maps.InfoWindow({
                                    content: `
                                        <div style="width: 300px; height: auto;">
                                            ${photoUrl ? `<img src="${photoUrl}" alt="${place.name}" style="width: 100%; height: 150px; object-fit: cover; margin-bottom: 10px;">` : ''}
                                            <h6>${place.name}</h6>
                                            <p>Price: ${priceString}</p>
                                            <p>Address: ${placeDetails.formatted_address}</p>
                                            <p>Rating: ${placeDetails.rating}</p>
                                            <a href="${placeDetails.url}" target="_blank">Hotel details</a>
                                        </div>
                                    `
                                });

                                marker.addListener('click', () => {
                                    if (currentInfoWindow) {
                                        currentInfoWindow.close();
                                    }
                                    currentInfoWindow = infoWindow;
                                    infoWindow.open(map, marker);
                                });

                                // Open info window immediately if it matches
                                infoWindow.open(map, marker);
                            }
                        });
                    } else {
                        marker.addListener('click', () => {
                            if (currentInfoWindow) {
                                currentInfoWindow.close();
                            }
                            service.getDetails({ placeId: place.place_id }, (placeDetails, status) => {
                                if (status === google.maps.places.PlacesServiceStatus.OK) {
                                    const priceLevel = placeDetails.price_level;
                                    const priceString = getPriceString(priceLevel);
                                    const photoUrl = placeDetails.photos ? placeDetails.photos[0].getUrl() : '';

                                    const infoWindow = new google.maps.InfoWindow({
                                        content: `
                                            <div style="width: 300px; height: auto;">
                                                ${photoUrl ? `<img src="${photoUrl}" alt="${place.name}" style="width: 100%; height: 150px; object-fit: cover; margin-bottom: 10px;">` : ''}
                                                <h6>${place.name}</h6>
                                                <p>Price: ${priceString}</p>
                                                <p>Address: ${placeDetails.formatted_address}</p>
                                                <p>Rating: ${placeDetails.rating}</p>
                                                <a href="${placeDetails.url}" target="_blank">Hotel details</a>
                                            </div>
                                        `
                                    });

                                    currentInfoWindow = infoWindow;
                                    infoWindow.open(map, marker);
                                }
                            });
                        });
                    }
                });

                if (!foundMatchingPlace) {

                }
            } else {
                console.error('Places search failed: ', status);
            }
        });
    }

    function clearMarkers() {
        markers.forEach(marker => marker.setMap(null));
        markers = [];
        if (currentInfoWindow) {
            currentInfoWindow.close();
            currentInfoWindow = null;
        }
    }

    function getPriceString(priceLevel) {
        switch (priceLevel) {
            case 0:
                return 'Free';
            case 1:
                return '₩0 - ₩80,800';
            case 2:
                return '₩80,800 - ₩161,600';
            case 3:
                return '₩161,600 - ₩242,400';
            case 4:
                return '₩242,400 - ₩323,200';
            case 5:
                return '₩404,000+';
            default:
                return 'N/A';
        }
    }

    document.addEventListener('DOMContentLoaded', initMap);
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJmWcT4VLac8E7KNO0HS0uP43Bn-IewbU&callback=initMap&libraries=places&v=weekly"
        defer>

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJmWcT4VLac8E7KNO0HS0uP43Bn-IewbU&callback=initMap"></script>

</body>
</html>