<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <title>YAYEOGI</title>
    <link rel="stylesheet" href="../static/css/header.css">
    <script>
        function getCookie(name) {
            let matches = document.cookie.match(new RegExp(
                "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
            ));
            return matches ? decodeURIComponent(matches[1]) : undefined;
        }

        function updateHeader() {
            const loggedIn = getCookie('loggedin') === 'true';
            const username = getCookie('username');

            const authSection = document.querySelector('.auth');

            if (loggedIn) {
                authSection.innerHTML = `
                    <button type="button" class="btn btn-secondary">
                        <img src="../static/html/layout/favorite.png" alt="찜"> 찜
                    </button>
                    <button type="button" class="btn btn-secondary">
                        <img src="../static/html/layout/user.png" alt="내정보"> ${username}님
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="logout()">
                        <img src="../static/html/layout/logout.png" alt="로그아웃"> 로그아웃
                    </button>
                `;
            } else {
                authSection.innerHTML = `
                    <button type="button" class="btn btn-secondary" onclick="location.href='signup.html'">
                        회원가입
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="location.href='login.html'">
                        로그인
                    </button>
                `;
            }
        }

        function logout() {
            // 로그아웃 로직을 서버와 동기화
            document.cookie = "loggedin=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;";
            document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;";
            location.reload(); // 페이지 새로고침
        }

        document.addEventListener('DOMContentLoaded', updateHeader);
    </script>
</head>
<body>
<header th:fragment="header">
<div class="header-body">
    <header>
        <div class="left-section">
            <button type="button" class="btn logo-button">
                <img src="../static/html/layout/logo2.png" height="65"
                                                               width="358"/>

            </button>
            &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <div class="menu">
                <button type="button" class="btn btn-info">항공권</button>
                <button type="button" class="btn btn-info">호텔</button>
            </div>
        </div>
        <div class="auth">
            <!-- 로그인 상태에 따라 이 부분이 동적으로 변경됩니다. -->
        </div>
    </header>
</div>
</header>
</body>
</html>
